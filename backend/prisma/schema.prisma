generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 String       @id @default(uuid())
  email              String       @unique
  username           String?      @unique
  googleId           String?      @unique @map("google_id")
  role               RoleEnum     @default(REGULAR)
  canSeeNSFW         Boolean      @default(false) @map("can_see_nsfw")
  isProfileCompleted Boolean      @default(false) @map("is_profile_completed")
  createdAt          DateTime     @default(now()) @map("created_at")
  Collection         Collection[]
  duels              Duel[]

  @@map("users")
}

model Collection {
  id                   String                   @id @default(uuid())
  title                String
  description          String?
  question             String?
  mode                 CollectionModeEnum
  isNSFW               Boolean                  @default(false) @map("is_nsfw")
  isLive               Boolean                  @default(true) @map("is_live")
  ownerId              String                   @map("owner_id")
  createdAt            DateTime                 @default(now()) @map("created_at")
  numImages            Int                      @default(0) @map("num_images")
  numVotes             Int                      @default(0) @map("num_votes")
  search_tsv           Unsupported("tsvector")? @default(dbgenerated("((setweight(to_tsvector('simple'::regconfig, COALESCE(title, ''::text)), 'A'::\"char\") || setweight(to_tsvector('simple'::regconfig, COALESCE(question, ''::text)), 'B'::\"char\")) || setweight(to_tsvector('simple'::regconfig, COALESCE(description, ''::text)), 'B'::\"char\"))"))
  maxUserVotesPerImage Int?                     @map("max_user_votes_per_image")
  owner                User                     @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  images               Image[]

  @@map("collections")
}

model Image {
  id               String    @id @default(uuid())
  filepath         String
  rating           Float
  ratingDeviation  Float     @map("rating_deviation")
  volatility       Float
  numVotes         Int       @default(0) @map("num_votes")
  height           Int
  width            Int
  createdAt        DateTime  @default(now()) @map("created_at")
  collectionId     String    @map("collection_id")
  lastVoteAt       DateTime? @map("last_vote_at")
  isSvg            Boolean   @default(false) @map("is_svg")
  availableWidths  Int[]     @default([]) @map("available_widths")
  availableFormats String[]  @default([]) @map("available_formats")
  hasPlaceholder   Boolean   @default(false) @map("has_placeholder")

  duelsAsImage1 Duel[]     @relation("image1Relation")
  duelsAsImage2 Duel[]     @relation("image2Relation")
  collection    Collection @relation(fields: [collectionId], references: [id], onDelete: Cascade)

  @@index([collectionId])
  @@map("images")
}

model Duel {
  id        String          @id @default(uuid())
  outcome   DuelOutcomeEnum
  image1Id  String          @map("image1_id")
  image2Id  String          @map("image2_id")
  voterId   String          @map("voter_id")
  createdAt DateTime        @default(now()) @map("created_at")
  image1    Image           @relation("image1Relation", fields: [image1Id], references: [id], onDelete: Cascade)
  image2    Image           @relation("image2Relation", fields: [image2Id], references: [id], onDelete: Cascade)
  voter     User            @relation(fields: [voterId], references: [id], onDelete: Cascade)

  @@map("duels")
}

enum RoleEnum {
  ADMIN
  REGULAR
}

enum CollectionModeEnum {
  PERSONAL
  PRIVATE
  PUBLIC
}

enum DuelOutcomeEnum {
  WIN
  LOSS
}
